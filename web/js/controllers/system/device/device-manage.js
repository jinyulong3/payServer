app.controller("deviceManage",["$scope","$uibModal","toaster","httpJsonHandle","myConstants","$translate",function(i,a,n,s,o,e){i.selected_group_id="0",i.app.myData.groupListNoAll=i.app.myData.groupList.slice(0),console.log(i.app.myData.groupListNoAll),"0"==i.app.myData.groupListNoAll[0].group_id&&i.app.myData.groupListNoAll.splice(0,1),i.default_search_select_station_list={station_id:"0",stationName:e.instant("public.all")},i.search_select_station_list=[i.default_search_select_station_list],i.selected_station_id="0",o.getStationListSendData.sessionId=i.app.myData.sessionId,0!=i.app.myData.role&&(i.selected_group_id=i.app.myData.groupListNoAll[0].group_id,1<i.app.myData.role&&(i.selected_group_id=i.app.myData.stationId,i.getDeviceListSendData.where=" station_id='"+i.selected_station_id+"'")),i.getDeviceListSendData={sessionId:i.app.myData.sessionId,tableName:"view_device_group_station",fields:[],where:"",limit:"",offset:""},i.filterOptions={filterText:"",useExternalFilter:!0},i.totalServerItems=0,i.pagingOptions={pageSizes:[10,15,25,50,100],pageSize:15,currentPage:1},i.columnDefs=[{field:"group_id",displayName:e.instant("items.customerManage.group_id"),width:"*"},{field:"groupName",displayName:e.instant("items.customerManage.groupName"),width:"*"},{field:"station_id",displayName:e.instant("items.stationManage.station_id"),width:"*"},{field:"stationName",displayName:e.instant("items.stationManage.stationName"),width:"*"},{field:"device_id",displayName:"设备编号",width:"*"},{field:"name",displayName:"设备名称",width:"*"},{field:"deviceType",displayName:"设备类型",width:"*",cellFilter:"filterDeviceType:this"},{field:"typeDes",displayName:"设备类型描述",width:"*"},{field:"remark",displayName:"备注",width:"*"},{field:"time_insert",displayName:"创建时间",width:"*",cellFilter:"filterDateStringSplitMs"}],i.callback=function(e){i.myData=e.fieldValues,i.totalServerItems=e.allCount,n.clear()},i.setPagingData=function(e,t){i.getDeviceListSendData.offset=1==e?0:(e-1)*t,i.getDeviceListSendData.limit=t,s.myPost2(o.URL.systemUrl,i.getDeviceListSendData,o.msgIdName.normalSelectMsgId,o.msgIdName.normalSelectMsgName,i.callback)},i.getPagedDataAsync=function(e,t,a){setTimeout(function(){n.pop("wait",constantsLang[i.app.myData.lang].load.reqData,constantsLang[i.app.myData.lang].load.loadingData),i.setPagingData(t,e)},100)},i.getPagedDataAsync(i.pagingOptions.pageSize,i.pagingOptions.currentPage),i.$watch("pagingOptions",function(e,t){e!==t&&i.getPagedDataAsync(i.pagingOptions.pageSize,i.pagingOptions.currentPage,i.filterOptions.filterText)},!0),i.$watch("filterOptions",function(e,t){e!==t&&i.getPagedDataAsync(i.pagingOptions.pageSize,i.pagingOptions.currentPage,i.filterOptions.filterText)},!0),i.gridOptions={i18n:"undefined"!=i.app.myData.lang?i.app.myData.lang:"zh-cn",data:"myData",enablePaging:!0,showFooter:!0,footerRowHeight:40,totalServerItems:"totalServerItems",pagingOptions:i.pagingOptions,enableColumnResizing:!0,rowHeight:28,enableRowSelection:!0,multiSelect:!1,columnDefs:"columnDefs",enableColumnResize:!0,showSelectionCheckbox:!0,filterOptions:i.filterOptions},i.callback_getStationList=function(e){i.search_select_station_list=i.search_select_station_list.concat(e.fieldValues),"0"!=i.selected_group_id?i.getDeviceListSendData.where=" group_id='"+i.selected_group_id+"'":i.getDeviceListSendData.where="",1!=i.pagingOptions.currentPage&&(i.pagingOptions.currentPage=1)},i.selectCustomerChange=function(){console.log(i.selected_group_id),i.search_select_station_list=[i.default_search_select_station_list],console.log(i.pagingOptions),"0"!=i.selected_group_id?(o.getStationListSendData.where=" group_id='"+i.selected_group_id+"'",i.pagingOptions.currentPage=1,i.getDeviceListSendData.where=" group_id='"+i.selected_group_id+"'"):(o.getStationListSendData.where="",i.pagingOptions.currentPage=1,i.getDeviceListSendData.where=""),0==i.app.myData.role&&i.getPagedDataAsync(i.pagingOptions.pageSize,i.pagingOptions.currentPage),s.myPost2(o.URL.systemUrl,o.getStationListSendData,o.msgIdName.normalSelectMsgId,o.msgIdName.normalSelectMsgName,i.callback_getStationList)},1==i.app.myData.role&&i.selectCustomerChange(),i.selectStationChange=function(){console.log(i.selected_group_id),"0"!=i.selected_station_id?i.getDeviceListSendData.where=" station_id='"+i.selected_station_id+"'":"0"!=i.selected_group_id?i.getDeviceListSendData.where=" group_id='"+i.selected_group_id+"'":i.getDeviceListSendData.where="",1!=i.pagingOptions.currentPage?i.pagingOptions.currentPage=1:i.getPagedDataAsync(i.pagingOptions.pageSize,i.pagingOptions.currentPage)},app.controller("btnClickAddDeviceCon",["$scope","$uibModalInstance","info","parentScope",function(e,t,a,i){e.parent=i,e.deviceTypes=constantsLang[i.app.myData.lang].deviceTypes,e.info=a,e.groupListNoAll=i.app.myData.groupListNoAll,e.info.group_id=e.groupListNoAll[0].group_id,e.stationListNoAll=[],e.ok=function(){e.info.sessionId=i.app.myData.sessionId,e.info.datatype=o.cmdType.ADD,e.callback2=function(e){n.clear(),n.pop("success",constantsLang[i.app.myData.lang].tips.success,constantsLang[i.app.myData.lang].tips.addSuccess,o.TIMEOUT.timeout1s),t.dismiss(0),i.getPagedDataAsync(i.pagingOptions.pageSize,i.pagingOptions.currentPage,i.filterOptions.filterText)},s.myPost2(o.URL.systemUrl,e.info,o.msgIdName.deviceManageMsgId,o.msgIdName.deviceManageMsgName,e.callback2,t),n.pop("wait",constantsLang[i.app.myData.lang].load.reqData,constantsLang[i.app.myData.lang].load.addingData)},e.cancel=function(){t.dismiss(0)}}]),i.btnClickAddDevice=function(){var e=i;a.open({templateUrl:"tpl/system/device/addDevice.html",controller:"btnClickAddDeviceCon",size:"md",resolve:{parentScope:e,info:function(){return{}}}})},app.controller("btnClickEditDeviceCon",["$scope","$uibModalInstance","info","parentScope",function(e,t,a,i){e.info=a,e.deviceTypes=constantsLang[i.app.myData.lang].deviceTypes,e.ok=function(){e.info.sessionId=i.app.myData.sessionId,e.info.datatype=o.cmdType.CHANGE,e.callback3=function(e){n.clear(),n.pop("success",constantsLang[i.app.myData.lang].tips.success,constantsLang[i.app.myData.lang].tips.editSuccess,o.TIMEOUT.timeout1s),t.dismiss(0),i.getPagedDataAsync(i.pagingOptions.pageSize,i.pagingOptions.currentPage,i.filterOptions.filterText)},s.myPost2(o.URL.systemUrl,e.info,o.msgIdName.deviceManageMsgId,o.msgIdName.deviceManageMsgName,e.callback3,t),n.pop("wait",constantsLang[i.app.myData.lang].load.reqData,constantsLang[i.app.myData.lang].load.editingData)},e.cancel=function(){t.dismiss(0)}}]),i.btnClickEditDevice=function(){var e=i.gridOptions.$gridScope.selectedItems;if(0==e.length)n.pop("info",constantsLang[i.app.myData.lang].tips.tip,constantsLang[i.app.myData.lang].tips.noSelectRow);else{var t=i;a.open({templateUrl:"tpl/system/device/editDevice.html",controller:"btnClickEditDeviceCon",size:"md",resolve:{parentScope:t,info:e[0]}})}},app.controller("btnClickDelDeviceCon",["$scope","$uibModalInstance","info","parentScope",function(e,t,a,i){e.info=a,e.ok=function(){e.info.sessionId=i.app.myData.sessionId,e.info.datatype=o.cmdType.DEL,e.callback3=function(e){n.clear(),n.pop("success",constantsLang[i.app.myData.lang].tips.success,constantsLang[i.app.myData.lang].tips.deleteSuccess,o.TIMEOUT.timeout1s),t.dismiss(0),i.getPagedDataAsync(i.pagingOptions.pageSize,i.pagingOptions.currentPage,i.filterOptions.filterText)},s.myPost2(o.URL.systemUrl,e.info,o.msgIdName.deviceManageMsgId,o.msgIdName.deviceManageMsgName,e.callback3,t),n.pop("wait",constantsLang[i.app.myData.lang].load.reqData,constantsLang[i.app.myData.lang].load.deletingData)},e.cancel=function(){t.dismiss(0)}}]),i.btnClickDelDevice=function(){var e=i.gridOptions.$gridScope.selectedItems;if(0==e.length)n.pop("info",constantsLang[i.app.myData.lang].tips.tip,constantsLang[i.app.myData.lang].tips.noSelectRow);else{var t=i;a.open({templateUrl:"tpl/system/device/delDevice.html",controller:"btnClickDelDeviceCon",size:"md",resolve:{parentScope:t,info:e[0]}})}}}]);