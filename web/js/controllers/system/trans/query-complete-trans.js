app.controller("queryCompleteTrans",["$scope","$uibModal","toaster","httpJsonHandle","myConstants","$translate",function(i,t,s,a,n,e){i.getCompleteTransListSendData={sessionId:i.app.myData.sessionId,group_id:"0",station_id:"0",device_id:"",gunNo:"",out_trade_no:"",startDate:"2010-01-01",endDate:"2100-01-01",payType:0,limit:"",offset:""};var o="undefined"!=i.app.myData.lang?i.app.myData.lang:"zh-cn";i.payTypes=constantsLang[o].payTypes,i.selected_group_id="0",i.app.myData.groupListNoAll=i.app.myData.groupList.slice(0),"0"==i.app.myData.groupListNoAll[0].group_id&&i.app.myData.groupListNoAll.splice(0,1),i.default_search_select_station_list={station_id:"0",stationName:e.instant("public.all")},i.search_select_station_list=[i.default_search_select_station_list],i.selected_station_id="0",n.getStationListSendData.sessionId=i.app.myData.sessionId,0!=i.app.myData.role&&(i.selected_group_id=i.app.myData.groupListNoAll[0].group_id),i.callback_getStationList=function(t){console.log(t),i.search_select_station_list=i.search_select_station_list.concat(t.fieldValues),console.log(i.search_select_station_list)},i.selectCustomerChange=function(){console.log(i.selected_group_id),i.search_select_station_list=[i.default_search_select_station_list],"0"!=i.selected_group_id?n.getStationListSendData.where=" group_id='"+i.selected_group_id+"'":n.getStationListSendData.where="",a.myPost2(n.URL.systemUrl,n.getStationListSendData,n.msgIdName.normalSelectMsgId,n.msgIdName.normalSelectMsgName,i.callback_getStationList)},1==i.app.myData.role&&i.selectCustomerChange(),i.selectStationChange=function(){console.log(i.selected_station_id),i.getCompleteTransListSendData.station_id=i.selected_station_id},i.filterOptions={filterText:"",useExternalFilter:!0},i.totalServerItems=0,i.pagingOptions={pageSizes:[10,15,25,50,100],pageSize:15,currentPage:1},i.columnDefs=[{field:"group_id",displayName:e.instant("items.customerManage.group_id"),width:"*"},{field:"station_id",displayName:e.instant("items.stationManage.station_id"),width:"*"},{field:"device_id",displayName:"设备编号",width:"*"},{field:"gunNo",displayName:"枪号",width:"*"},{field:"cumulativeLiter",displayName:"升累计",width:"*"},{field:"ttc",displayName:"ttc",width:"*"},{field:"payType",displayName:e.instant("items.completeTrans.payType"),width:"*",cellFilter:"filterPayType:this"},{field:"trans_id",displayName:e.instant("items.completeTrans.trans_id"),width:"*"},{field:"out_trade_no",displayName:e.instant("items.completeTrans.out_trade_no"),width:"120"},{field:"amountPay",displayName:e.instant("items.completeTrans.amountPay"),width:"*"},{field:"amountRefund",displayName:e.instant("items.completeTrans.amountRefund"),width:"*"},{field:"subject",displayName:e.instant("items.completeTrans.subject"),width:150},{field:"body",displayName:e.instant("items.completeTrans.body"),width:120},{field:"time",displayName:e.instant("items.completeTrans.time"),width:"*",cellFilter:"filterDateStringSplitMs"},{field:"time_insert",displayName:e.instant("items.completeTrans.time_insert"),width:140,cellFilter:"filterDateStringSplitMs"}],i.callback=function(t){i.myData=t.transList,i.totalServerItems=t.allCount,s.clear()},i.setPagingData=function(t,e){i.getCompleteTransListSendData.offset=1==t?0:(t-1)*e,i.getCompleteTransListSendData.limit=e,a.myPost2(n.URL.systemUrl,i.getCompleteTransListSendData,n.msgIdName.getCompleteTransListMsgId,n.msgIdName.getCompleteTransListMsgName,i.callback)},i.getPagedDataAsync=function(t,e,a){setTimeout(function(){s.pop("wait",constantsLang[i.app.myData.lang].load.reqData,constantsLang[i.app.myData.lang].load.loadingData),i.setPagingData(e,t)},100)},i.getPagedDataAsync(i.pagingOptions.pageSize,i.pagingOptions.currentPage),i.$watch("pagingOptions",function(t,e){t!==e&&i.getPagedDataAsync(i.pagingOptions.pageSize,i.pagingOptions.currentPage,i.filterOptions.filterText)},!0),i.$watch("filterOptions",function(t,e){t!==e&&i.getPagedDataAsync(i.pagingOptions.pageSize,i.pagingOptions.currentPage,i.filterOptions.filterText)},!0),i.gridOptions={i18n:"undefined"!=i.app.myData.lang?i.app.myData.lang:"zh-cn",data:"myData",enablePaging:!0,showFooter:!0,footerRowHeight:40,totalServerItems:"totalServerItems",pagingOptions:i.pagingOptions,enableColumnResizing:!0,rowHeight:28,enableRowSelection:!0,multiSelect:!1,columnDefs:"columnDefs",enableColumnResize:!0,showSelectionCheckbox:!1,noUnselect:!0,filterOptions:i.filterOptions,enableCellEditOnFocus:!0},i.goExcel=function(){console.log("开始导出excel");var t=JSON.parse(JSON.stringify(i.getCompleteTransListSendData));t.limit=1e3,t.offset=0,t.toExcel=1;a.myPost2(n.URL.systemUrl,t,n.msgIdName.getCompleteTransListMsgId,n.msgIdName.getCompleteTransListMsgName,function(t){console.log(t),console.log(window.location.host+"/web/"+t.excelPath),window.open("http://"+window.location.host+"/web/"+t.excelPath)})},i.goQuery=function(){console.log(i.getCompleteTransListSendData.payType),i.getCompleteTransListSendData.group_id=i.selected_group_id,i.getCompleteTransListSendData.station_id=i.selected_station_id,i.startDate=$("#startDate").val(),i.stopDate=$("#stopDate").val();var t="2019-01-01",e="2100-01-01";""!=i.startDate&&(t=i.startDate),""!=i.stopDate&&(e=i.stopDate),i.getCompleteTransListSendData.startDate=t,i.getCompleteTransListSendData.endDate=e,i.getCompleteTransListSendData.device_id=i.selected_device_id,i.getCompleteTransListSendData.out_trade_no=i.selected_out_trade_no,i.getCompleteTransListSendData.gunNo=i.selected_gun_no,i.getPagedDataAsync(i.pagingOptions.pageSize,1,i.filterOptions.filterText)}}]);