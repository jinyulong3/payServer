app.controller("queryPayTrans",["$scope","$uibModal","toaster","httpJsonHandle","myConstants","$translate",function(s,t,i,a,n,e){s.getCompleteTransListSendData={sessionId:s.app.myData.sessionId,group_id:"0",station_id:"0",device_id:"",paySetType:0,startDate:"2010-01-01",endDate:"2100-01-01",out_trade_no:"",transaction_id:"",payType:0,limit:"",offset:""};var o="undefined"!=s.app.myData.lang?s.app.myData.lang:"zh-cn";s.payTypes=constantsLang[o].payTypes,s.paySetTypes=constantsLang[o].paySetTypes,console.log(constantsLang[o]),console.log(s.paySetTypes),s.selected_group_id="0",s.app.myData.groupListNoAll=s.app.myData.groupList.slice(0),"0"==s.app.myData.groupListNoAll[0].group_id&&s.app.myData.groupListNoAll.splice(0,1),s.default_search_select_station_list={station_id:"0",stationName:e.instant("public.all")},s.search_select_station_list=[s.default_search_select_station_list],s.selected_station_id="0",n.getStationListSendData.sessionId=s.app.myData.sessionId,0!=s.app.myData.role&&(s.selected_group_id=s.app.myData.groupListNoAll[0].group_id),s.callback_getStationList=function(t){console.log(t),s.search_select_station_list=s.search_select_station_list.concat(t.fieldValues),console.log(s.search_select_station_list)},s.selectCustomerChange=function(){console.log(s.selected_group_id),s.search_select_station_list=[s.default_search_select_station_list],"0"!=s.selected_group_id?n.getStationListSendData.where=" group_id='"+s.selected_group_id+"'":n.getStationListSendData.where="",a.myPost2(n.URL.systemUrl,n.getStationListSendData,n.msgIdName.normalSelectMsgId,n.msgIdName.normalSelectMsgName,s.callback_getStationList)},1==s.app.myData.role&&s.selectCustomerChange(),s.selectStationChange=function(){console.log(s.selected_station_id),s.getCompleteTransListSendData.station_id=s.selected_station_id},s.filterOptions={filterText:"",useExternalFilter:!0},s.totalServerItems=0,s.pagingOptions={pageSizes:[10,15,25,50,100],pageSize:15,currentPage:1},s.columnDefs=[{field:"group_id",displayName:e.instant("items.customerManage.group_id"),width:"90"},{field:"station_id",displayName:e.instant("items.stationManage.station_id"),width:"90"},{field:"device_id",displayName:"设备编号",width:"*"},{field:"payType",displayName:e.instant("items.completeTrans.payType"),width:"*",cellFilter:"filterPayType:this"},{field:"out_trade_no",displayName:e.instant("items.completeTrans.out_trade_no"),width:250},{field:"total_amount",displayName:e.instant("items.payTrans.total_amount"),width:"*"},{field:"total_disc_amt",displayName:"优惠金额",width:"*"},{field:"payment_amt",displayName:"实付金额",width:"*"},{field:"transaction_id",displayName:e.instant("items.payTrans.transaction_id"),width:"*"},{field:"time_insert",displayName:e.instant("items.completeTrans.time_insert"),width:140,cellFilter:"filterDateStringSplitMs"}],s.callback=function(t){s.myData=t.transList,s.totalServerItems=t.allCount,i.clear()},s.setPagingData=function(t,e){s.getCompleteTransListSendData.offset=1==t?0:(t-1)*e,s.getCompleteTransListSendData.limit=e,a.myPost2(n.URL.systemUrl,s.getCompleteTransListSendData,n.msgIdName.getPayTransListMsgId,n.msgIdName.getPayTransListMsgName,s.callback)},s.getPagedDataAsync=function(t,e,a){setTimeout(function(){i.pop("wait",constantsLang[s.app.myData.lang].load.reqData,constantsLang[s.app.myData.lang].load.loadingData),s.setPagingData(e,t)},100)},s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage),s.$watch("pagingOptions",function(t,e){t!==e&&s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},!0),s.$watch("filterOptions",function(t,e){t!==e&&s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},!0),s.gridOptions={i18n:"undefined"!=s.app.myData.lang?s.app.myData.lang:"zh-cn",data:"myData",enablePaging:!0,showFooter:!0,footerRowHeight:40,totalServerItems:"totalServerItems",pagingOptions:s.pagingOptions,enableColumnResizing:!0,rowHeight:28,enableRowSelection:!1,multiSelect:!1,columnDefs:"columnDefs",enableColumnResize:!0,showSelectionCheckbox:!1,noUnselect:!1,filterOptions:s.filterOptions,noUnselect:!1,enableCellEditOnFocus:!0},s.goExcel=function(){console.log("开始导出excel");var t=JSON.parse(JSON.stringify(s.getCompleteTransListSendData));t.limit=1e3,t.offset=0,t.toExcel=1;a.myPost2(n.URL.systemUrl,t,n.msgIdName.getTransListMsgId,n.msgIdName.getTransListMsgName,function(t){console.log(t),console.log(window.location.host+"/web/"+t.excelPath),window.open("http://"+window.location.host+"/web/"+t.excelPath)})},s.goQuery=function(){console.log(s.getCompleteTransListSendData.payType),s.getCompleteTransListSendData.group_id=s.selected_group_id,s.getCompleteTransListSendData.station_id=s.selected_station_id,s.startDate=$("#startDate").val(),s.stopDate=$("#stopDate").val();var t="2019-01-01",e="2100-01-01";""!=s.startDate&&(t=s.startDate),""!=s.stopDate&&(e=s.stopDate),s.getCompleteTransListSendData.startDate=t,s.getCompleteTransListSendData.endDate=e,s.getCompleteTransListSendData.out_trade_no=s.selected_out_trade_no,s.getCompleteTransListSendData.transaction_id=s.selected_transaction_id,s.getCompleteTransListSendData.device_id=s.selected_device_id,s.getPagedDataAsync(s.pagingOptions.pageSize,1,s.filterOptions.filterText)}}]);