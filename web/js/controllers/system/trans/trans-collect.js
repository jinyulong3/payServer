app.controller("transCollect",["$scope","$uibModal","toaster","httpJsonHandle","myConstants","$translate",function(t,e,a,l,s,o){t.getTransCollect={sessionId:t.app.myData.sessionId,group_id:"0",station_id:"0",device_id:"",paySetType:0,startDate:"2010-01-01",endDate:"2100-01-01",payType:0};var n="undefined"!=t.app.myData.lang?t.app.myData.lang:"zh-cn";t.payTypes=constantsLang[n].payTypes,t.paySetTypes=constantsLang[n].paySetTypes,console.log(constantsLang[n]),console.log(t.paySetTypes),t.selected_group_id="0",t.app.myData.groupListNoAll=t.app.myData.groupList.slice(0),"0"==t.app.myData.groupListNoAll[0].group_id&&t.app.myData.groupListNoAll.splice(0,1),t.selected_station_id="0",s.getStationListSendData.sessionId=t.app.myData.sessionId,0!=t.app.myData.role&&(t.selected_group_id=t.app.myData.groupListNoAll[0].group_id),t.callback_getStationList=function(e){console.log(e),t.search_select_station_list=t.search_select_station_list.concat(e.fieldValues),console.log(t.search_select_station_list)},t.selectCustomerChange=function(){console.log(t.selected_group_id),t.search_select_station_list=[t.default_search_select_station_list],"0"!=t.selected_group_id?s.getStationListSendData.where=" group_id='"+t.selected_group_id+"'":s.getStationListSendData.where="",l.myPost2(s.URL.systemUrl,s.getStationListSendData,s.msgIdName.normalSelectMsgId,s.msgIdName.normalSelectMsgName,t.callback_getStationList)},1==t.app.myData.role&&t.selectCustomerChange(),t.selectStationChange=function(){console.log(t.selected_station_id),t.getTransCollect.station_id=t.selected_station_id},t.filterOptions={filterText:"",useExternalFilter:!0},t.totalServerItems=0,t.pagingOptions={pageSizes:[10,15,25,50,100],pageSize:15,currentPage:1},t.columnDefs=[{field:"payType",displayName:o.instant("items.completeTrans.payType"),width:"*",cellFilter:"filterPayType:this"},{field:"allFinishCount",displayName:"完成订单个数",width:"*"},{field:"allFinishPayMoney",displayName:"完成订单支付金额",width:"*"},{field:"allFinishRefundMoney",displayName:"完成订单退款金额",width:"*"},{field:"allPayCount",displayName:"总支付次数",width:"*"},{field:"allPayMoney",displayName:"总支付金额",width:"*"},{field:"allDisMoney",displayName:"总优惠金额",width:"*"},{field:"allRealPayment",displayName:"总实际支付金额",width:"*"},{field:"allRefundCount",displayName:"总退款次数",width:"*"},{field:"allRefundMoney",displayName:"总退款金额",width:"*"},{field:"allRealRefundMoney",displayName:"总退款到用户金额",width:"*"}],t.gridOptions={i18n:"undefined"!=t.app.myData.lang?t.app.myData.lang:"zh-cn",data:"myData",enablePaging:!0,showFooter:!1,footerRowHeight:40,totalServerItems:"totalServerItems",pagingOptions:t.pagingOptions,enableColumnResizing:!0,rowHeight:28,enableRowSelection:!1,multiSelect:!1,columnDefs:"columnDefs",enableColumnResize:!0,showSelectionCheckbox:!1,noUnselect:!1,filterOptions:t.filterOptions},t.goExcel=function(){console.log("开始导出excel");var e=JSON.parse(JSON.stringify(t.getTransCollect));e.limit=1e3,e.offset=0,e.toExcel=1;l.myPost2(s.URL.systemUrl,e,s.msgIdName.getTransListMsgId,s.msgIdName.getTransListMsgName,function(e){window.open("http://"+window.location.host+"/web/"+e.excelPath)})},t.label_0="支付金额",t.data_0=0,t.label_1="退款金额",t.data_1=0,t.label_00="支付金额",t.data_00=0,t.label_01="退款金额",t.data_01=0,t.callback=function(e){t.myData=new Array,t.myData.push(e),t.data_00=e.allFinishPayMoney,t.label_00="支付金额:"+t.data_00,t.data_01=e.allFinishRefundMoney,t.label_01="退款金额:"+t.data_01,t.data_0=e.allPayMoney,t.label_0="支付金额:"+t.data_0,t.data_1=e.allRefundMoney,t.label_1="退款金额:"+t.data_1,console.log(t.data_0),console.log(t.data_1),a.clear()},t.goQuery=function(){console.log(t.getTransCollect.payType),console.log(t.selected_group_id),console.log(t.selected_station_id),t.app.myData.role<2&&("0"==t.selected_group_id||"0"==t.selected_station_id)?a.pop("info",constantsLang[t.app.myData.lang].tips.tip,"请选择集团和站点"):(t.getTransCollect.group_id=t.selected_group_id,t.getTransCollect.station_id=t.selected_station_id,""!=$("#startDate").val()&&""!=$("#stopDate").val()?(t.startDate=$("#startDate").val(),t.stopDate=$("#stopDate").val(),t.getTransCollect.startDate=t.startDate,t.getTransCollect.endDate=t.stopDate,t.getTransCollect.device_id=t.selected_device_id,l.myPost2(s.URL.systemUrl,t.getTransCollect,s.msgIdName.getTransCollectMsgId,s.msgIdName.getTransCollectMsgName,t.callback)):a.pop("info",constantsLang[t.app.myData.lang].tips.tip,"请选择时间"))}}]);