app.controller("userManage",["$scope","$uibModal","toaster","httpJsonHandle","myConstants","$state","$translate",function(s,a,n,i,o,t,e){console.log(e.instant("title")),s.selected_group_id="0",s.app.myData.groupListNoAll=s.app.myData.groupList.slice(0),"0"==s.app.myData.groupListNoAll[0].group_id&&s.app.myData.groupListNoAll.splice(0,1),0!=s.app.myData.role&&(s.selected_group_id=s.app.myData.groupListNoAll[0].group_id),console.log(s.selected_group_id),s.default_search_select_station_list={station_id:"0",stationName:e.instant("public.all")},s.search_select_station_list=[s.default_search_select_station_list],s.selected_station_id="0",o.getStationListSendData.sessionId=s.app.myData.sessionId,s.callback_getStationList=function(t){s.search_select_station_list=s.search_select_station_list.concat(t.fieldValues),"0"!=s.selected_group_id?s.getUserListSendData.where=" group_id='"+s.selected_group_id+"'":s.getUserListSendData.where="",1!=s.pagingOptions.currentPage&&(s.pagingOptions.currentPage=1)},s.selectCustomerChange=function(){s.search_select_station_list=[s.default_search_select_station_list],console.log(s.selected_group_id),"0"!=s.selected_group_id?o.getStationListSendData.where=" group_id='"+s.selected_group_id+"'":o.getStationListSendData.where="",i.myPost2(o.URL.systemUrl,o.getStationListSendData,o.msgIdName.normalSelectMsgId,o.msgIdName.normalSelectMsgName,s.callback_getStationList)},1==s.app.myData.role&&s.selectCustomerChange(),s.selectStationChange=function(){"0"!=s.selected_station_id?s.getUserListSendData.where=" station_id='"+s.selected_station_id+"'":"0"!=s.selected_group_id?s.getUserListSendData.where=" group_id='"+s.selected_group_id+"'":s.getUserListSendData.where="",1!=s.pagingOptions.currentPage?s.pagingOptions.currentPage=1:s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage)},s.getUserListSendData={sessionId:s.app.myData.sessionId,tableName:"view_user_group_station",fields:[],where:"",limit:"",offset:""},s.filterOptions={filterText:"",useExternalFilter:!0},s.totalServerItems=0,s.pagingOptions={pageSizes:[10,15,25,50,100],pageSize:15,currentPage:1},s.columnDefs=[{field:"group_id",displayName:e.instant("items.customerManage.group_id"),width:"*"},{field:"groupName",displayName:e.instant("items.customerManage.groupName"),width:"*"},{field:"station_id",displayName:e.instant("items.stationManage.station_id"),width:"*"},{field:"stationName",displayName:e.instant("items.stationManage.stationName"),width:"*"},{field:"role",displayName:e.instant("items.userManage.role"),cellFilter:"filterUserRole:this"},{field:"username",displayName:e.instant("items.userManage.username"),width:"*"},{field:"name",displayName:e.instant("items.userManage.name"),width:"*"},{field:"telephone",displayName:e.instant("items.userManage.telephone"),width:"*"},{field:"remark",displayName:e.instant("items.userManage.remark"),width:"*"},{field:"time_insert",displayName:e.instant("items.stationManage.regTime"),width:"*",cellFilter:"filterDateStringSplitMs"}],s.callback=function(t){s.myData=t.fieldValues,s.totalServerItems=t.allCount,n.clear()},s.setPagingData=function(t,e){if(s.getUserListSendData.offset=1==t?0:(t-1)*e,s.getUserListSendData.limit=e,0==s.app.myData.role)-1==s.getUserListSendData.where.indexOf("group_id")&&-1==s.getUserListSendData.where.indexOf("station_id")&&(s.getUserListSendData.where="");else if(1==s.app.myData.role)console.log(s.app.myData.groupId),-1==s.getUserListSendData.where.indexOf("group_id")&&-1==s.getUserListSendData.where.indexOf("station_id")&&(s.getUserListSendData.where=" group_id='"+s.app.myData.groupId+"'");else{if(2!=s.app.myData.role)return;-1==s.getUserListSendData.where.indexOf("station_id")&&(s.getUserListSendData.where=" station_id='"+s.app.myData.station_id+"'")}i.myPost2(o.URL.systemUrl,s.getUserListSendData,o.msgIdName.normalSelectMsgId,o.msgIdName.normalSelectMsgName,s.callback)},s.getPagedDataAsync=function(t,e,a){setTimeout(function(){n.pop("wait",constantsLang[s.app.myData.lang].load.reqData,constantsLang[s.app.myData.lang].load.loadingData),s.setPagingData(e,t)},100)},s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage),s.$watch("pagingOptions",function(t,e){t!==e&&s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},!0),s.$watch("filterOptions",function(t,e){t!==e&&s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},!0),s.gridOptions={i18n:"undefined"!=s.app.myData.lang?s.app.myData.lang:"zh-cn",data:"myData",enablePaging:!0,showFooter:!0,footerRowHeight:40,totalServerItems:"totalServerItems",pagingOptions:s.pagingOptions,enableColumnResizing:!0,rowHeight:28,enableRowSelection:!0,multiSelect:!1,columnDefs:"columnDefs",enableColumnResize:!0,showSelectionCheckbox:!0,filterOptions:s.filterOptions},app.controller("btnClickAddUserCon",["$scope","$uibModalInstance","info","parentScope",function(t,e,a,s){t.parent=s,t.info=a,t.groupListNoAll=s.app.myData.groupListNoAll,t.info.group_id=t.groupListNoAll[0].group_id,t.stationListNoAll=[],t.ok=function(){t.info.sessionId=s.app.myData.sessionId,t.info.datatype=o.cmdType.ADD,t.callback2=function(t){n.clear(),n.pop("success",constantsLang[s.app.myData.lang].tips.success,constantsLang[s.app.myData.lang].tips.addSuccess,o.TIMEOUT.timeout1s),e.dismiss(0),s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},i.myPost2(o.URL.systemUrl,t.info,o.msgIdName.userManageMsgId,o.msgIdName.userManageMsgName,t.callback2,e),n.pop("wait",constantsLang[s.app.myData.lang].load.reqData,constantsLang[s.app.myData.lang].load.addingData)},t.cancel=function(){e.dismiss(0)}}]),s.btnClickAddOil=function(){var t=s;a.open({templateUrl:"tpl/system/user/addUser.html",controller:"btnClickAddUserCon",size:"md",resolve:{parentScope:t,info:function(){return{}}}})},app.controller("btnClickEditUserCon",["$scope","$uibModalInstance","info","parentScope",function(t,e,a,s){t.info=a,t.ok=function(){t.info.sessionId=s.app.myData.sessionId,t.info.datatype=o.cmdType.CHANGE,console.log(t.info),t.callback3=function(a){n.clear(),n.pop("success",constantsLang[s.app.myData.lang].tips.success,constantsLang[s.app.myData.lang].tips.editSuccess,o.TIMEOUT.timeout1s),e.dismiss(0),s.app.myData.stationList.forEach(function(t,e){t.station_id==a.station_id&&(s.app.myData.stationList[e].stationName=a.stationName)}),s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},i.myPost2(o.URL.systemUrl,t.info,o.msgIdName.userManageMsgId,o.msgIdName.userManageMsgName,t.callback3,e),n.pop("wait",constantsLang[s.app.myData.lang].load.reqData,constantsLang[s.app.myData.lang].load.editingData)},t.cancel=function(){e.dismiss(0)}}]),s.btnClickEditOil=function(){var t=s.gridOptions.$gridScope.selectedItems;if(0==t.length)n.pop("info",constantsLang[s.app.myData.lang].tips.tip,constantsLang[s.app.myData.lang].tips.noSelectRow);else{var e=s;a.open({templateUrl:"tpl/system/user/editUser.html",controller:"btnClickEditUserCon",size:"md",resolve:{parentScope:e,info:t[0]}})}},app.controller("btnClickDelUserCon",["$scope","$uibModalInstance","info","parentScope",function(t,e,a,s){t.info=a,t.ok=function(){t.info.sessionId=s.app.myData.sessionId,t.info.datatype=o.cmdType.DEL,t.callback3=function(t){n.clear(),n.pop("success",constantsLang[s.app.myData.lang].tips.success,constantsLang[s.app.myData.lang].tips.deleteSuccess,o.TIMEOUT.timeout1s),e.dismiss(0),s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},i.myPost2(o.URL.systemUrl,t.info,o.msgIdName.userManageMsgId,o.msgIdName.userManageMsgName,t.callback3,e),n.pop("wait",constantsLang[s.app.myData.lang].load.reqData,constantsLang[s.app.myData.lang].load.deletingData)},t.cancel=function(){e.dismiss(0)}}]),s.btnClickDelOil=function(){var t=s.gridOptions.$gridScope.selectedItems;if(0==t.length)n.pop("info",constantsLang[s.app.myData.lang].tips.tip,constantsLang[s.app.myData.lang].tips.noSelectRow);else{if(t[0].username==s.app.myData.username)return void n.pop("info","提示","不可删除当前登录用户");var e=s;a.open({templateUrl:"tpl/system/user/delUser.html",controller:"btnClickDelUserCon",size:"md",resolve:{parentScope:e,info:t[0]}})}}}]);